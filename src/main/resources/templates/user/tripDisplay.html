<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="utf-8">
	<title>WayFinder - Itinerary Display</title>


	<!-- Meta Tags -->
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
	<meta name="description" content="Trip Display - View itinerary here">

	<!-- Favicon -->
	<link rel="shortcut icon" href="/images/favicon.ico" />

	<!-- Google Font -->
	<link rel="preconnect" href="https://fonts.googleapis.com">
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="stylesheet"
		href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;700&family=Poppins:wght@400;500;700&display=swap">

	<!-- Plugins CSS -->
	<link rel="stylesheet" type="text/css" href="/vendor/font-awesome/css/all.min.css" />
	<link rel="stylesheet" type="text/css" href="/vendor/bootstrap-icons/bootstrap-icons.css" />
	<link rel="stylesheet" type="text/css" href="/vendor/splide-master/dist/css/splide.min.css">
	<link rel="stylesheet" type="text/css" href="/vendor/glightbox/css/glightbox.css">

	<!-- Theme CSS -->
	<link rel="stylesheet" type="text/css" href="/css/style.css" />

	<!-- Google Maps Polygon Style -->
	<script src="https://polyfill.io/v3/polyfill.min.js?features=default"></script>

</head>

<body>

	<!-- Header START -->
	<header class="header-sticky" style="display:block">
		<!-- Logo Nav START -->
		<nav class="navbar navbar-light navbar-expand-xl">
			<div class="container-fluid px-md-5">
				<!-- Logo START -->
				<a class="navbar-brand" href="/">
					<h3>WayFinder</h3>
					<!-- Logo END -->



					<!-- Profile and Notification START -->
					<ul class="nav flex-row align-items-center list-unstyled ms-xl-auto">

						<!-- Profile dropdown START -->
						<li class="nav-item ms-3 dropdown">
							<!-- Avatar -->
							<a class="avatar avatar-sm p-0" href="#" id="profileDropdown" role="button"
								data-bs-auto-close="outside" data-bs-display="static" data-bs-toggle="dropdown"
								aria-expanded="false">
								<img class="avatar-img rounded-2" src="/images/avatar/profile_avatar.jpg"
									alt="profile_avatar">
							</a>

							<ul class="dropdown-menu dropdown-animation dropdown-menu-end shadow pt-3"
								aria-labelledby="profileDropdown">
								<!-- Profile info -->
								<li class="px-3 mb-3">
									<div class="d-flex align-items-center">
										<!-- Avatar -->
										<div class="avatar me-3">
											<img class="avatar-img rounded-circle shadow"
												src="/images/avatar/profile_avatar.jpg" alt="profile_avatar">
										</div>
										<div>
											<a class="h6 mt-2 mt-sm-0" href="#"><span
													th:text="${user.username}"></span></a>
											<p class="small m-0"><span th:text="${user.email}"></span></p>
										</div>
									</div>
								</li>

								<!-- Links -->
								<li>
									<hr class="dropdown-divider">
								</li>
								<li><a class="dropdown-item" href="/user/editPrefs"><i
											class="bi bi-gear fa-fw me-2"></i>Preference Settings</a></li>
								<li><a class="dropdown-item" href="/user/editAccSettings"><i
											class="bi bi-person fa-fw me-2"></i>Account Settings</a></li>
								<li><a class="dropdown-item bg-danger-soft-hover" href="/user/logout"><i
											class="bi bi-power fa-fw me-2"></i>Sign Out</a></li>
								<li>
									<hr class="dropdown-divider">
								</li>
							</ul>
						</li>
						<!-- Profile dropdown END -->
					</ul>
			</div>
		</nav>
		<!-- Logo Nav END -->
	</header>
	<!-- Header END -->

	<!-- **************** MAIN CONTENT START **************** -->
	<main>

		<!-- =======================
Main Banner START -->
		<section class="pt-4 pt-lg-5">
			<div class="container position-relative">

				<!-- Title and button START -->
				<div class="row">
					<div class="col-12">

						<!-- Meta -->
						<div class="d-md-flex justify-content-md-between">
							<!-- Title -->
							<div>
								<h1 class="fs-2"><span th:text="${currTrip.location}"></span></h1>
								<ul class="nav nav-divider h6 text-body mb-0">
									<li class="nav-item"><span th:text="${currTrip.startDate}"></span> to <span
											th:text="${currTrip.endDate}"></span></li>
									<li class="nav-item"><span th:text="${currTrip.budget}"></span>
								</ul>
							</div>
						</div>
					</div>
				</div>
				<!-- Title and button END -->

				<!-- Image gallery START -->
				<div class="row mt-md-5">
					<div class="col-12">
						<!-- Primary image -->
						<div class="splide splide-main mb-3"
							data-splide='{"type" : "fade","autoplay": true,"heightRatio":0.5,"pagination":false,"arrows":false,"cover":true,"lazyLoad":"sequential"}'>
							<div class="splide__track">
								<ul class="splide__list">
									<li class="splide__slide rounded"><img src="/images/gallery/04.jpg" alt="">
								</ul>
							</div>
						</div>
						<!-- Secondary image -->
						<div class="splide splide-thumb display-none" data-splide='{"arrows":false}'>
							<div class="splide__track">
								<ul class="splide__list">
								</ul>
							</div>
						</div>
					</div>
				</div>
				<!-- Image gallery END -->

			</div>
		</section>
		<!-- =======================
Main Banner END -->

		<!-- =======================
Tabs-content START -->
		<section class="pt-1 pt-md-5">
			<div class="row">
				<!-- Tabs Content START -->
				<div class="col-8 mx-auto">
					<!-- Content item START -->
					<div class="card bg-transparent p-4">
						<!-- Card header -->
						<div class="card-header bg-transparent p-0 pb-3">
							<h2 class="mb-0">Trip Itinerary</h2>
						</div>

						<!--						TESTING 								-->
						<!-- Card body START -->
						<div class="card-body p-0 pt-3" th:each="day, num:${itinerary}">
							<span class="h3 p-0 pb-2" th:text="${day.key}"></span>
							<hr class="my-0 p-2 mt-2"> <!-- Divider -->
							<div class="accordion accordion-icon accordion-bg-light"
								th:id="'#accordionExample' + ${num.index}">
								<!-- Item -->
								<div th:each="location, i:${day.value}">
									<div class="accordion-item mb-3">
										<h6 class="accordion-header font-base"
											th:id="'heading-' + ${i.index + (num.index * 4)}">
											<button class="accordion-button rounded d-inline-block collapsed"
												type="button" data-bs-toggle="collapse" aria-expanded="false"
												th:attr="data-bs-target='#collapse-'+ ${i.index + (num.index * 4)}, aria-controls='collapse-' + ${i.index + (num.index * 4)}">
												<span class="lead me-1 fw-normal" th:text="${location.key}"><span>
											</button>
										</h6>
										<!-- Body -->
										<div th:id="'collapse-' + ${i.index + (num.index * 4)}"
											class="accordion-collapse collapse"
											th:attr="aria-labelledby='heading-' + ${i.index + (num.index * 4)}, data-bs-parent='#accordionExample' + ${num.index}">
											<div class="accordion-body mt-3">

												<span class="h5 mb-0 me-1" th:text="${location.key}"></span>
												<p class="h6 mb-0 me-1" th:text="${location.value}"></p>

												<!--				MAP WOULD GO HERE  						-->
												<div th:id="'map'+ ${i.index + (num.index * 4)}"></div>

											</div>
										</div>
									</div>
								</div>
							</div>
						</div>
						<!-- Card body END -->
					</div>
					<!-- Content item END -->

					<!-- Tabs Content END -->
				</div>

			</div> <!-- Row END -->

			<!-- THIS IS FOR DEBUGGING PURPOSES ONLY -->
			<p style="display: none">[[${location}]]</p>
		</section>
		<!-- =======================
Tabs-content END -->

	</main>
	<!-- **************** MAIN CONTENT END **************** -->

	<!-- =======================
Footer START -->
	<footer class="bg-dark pt-5" style="display:block">
		<div class="container">
			<!-- Row START -->
			<div class="row g-4">

				<!-- Widget 1 START -->
				<div class="col-lg-3">
					<div class="my-3 text-muted">Created by Project Group 12</div>
				</div>
				<!-- Widget 1 END -->

			</div><!-- Row END -->

			<!-- Divider -->
			<hr class="mt-4 mb-0">

			<!-- Bottom footer -->
			<div class="row">
				<div class="container">
					<div class="d-lg-flex justify-content-between align-items-center py-3 text-center text-lg-start">
						<!-- copyright text -->
						<p class="text-muted text-primary-hover"> Â© 2023 WayFinder. All Rights Reserved. </p>
						<!-- copyright links-->
						<!-- HIDE FROM VIEW SINCE NOT DOING ANYTHING -->
						<div class="nav mt-2 mt-lg-0" style="display: none">
							<ul class="list-inline text-primary-hover mx-auto mb-0">
								<li class="list-inline-item me-0"><a class="nav-link py-1 text-muted" href="#">Meet the
										Team</a></li>
								<li class="list-inline-item me-0"><a class="nav-link py-1 text-muted" href="#">Home</a>
								</li>
							</ul>
						</div>
					</div>
				</div>
			</div>
		</div>
	</footer>
	</div>
	<!-- =======================
Footer END -->

	<!-- Back to top -->
	<div class="back-top"></div>

	<!-- Bootstrap JS -->
	<script src="/vendor/bootstrap/dist/js/bootstrap.bundle.min.js"></script>

	<!-- Vendors -->
	<script src="/vendor/splide-master/dist/js/splide.min.js"></script>
	<script src="/vendor/glightbox/js/glightbox.js"></script>

	<!-- ThemeFunctions -->
	<script src="/js/functions.js"></script>

	<!-- Load Google Maps API -->
	<script async defer>(g => { var h, a, k, p = "The Google Maps JavaScript API", c = "google", l = "importLibrary", q = "__ib__", m = document, b = window; b = b[c] || (b[c] = {}); var d = b.maps || (b.maps = {}), r = new Set, e = new URLSearchParams, u = () => h || (h = new Promise(async (f, n) => { await (a = m.createElement("script")); e.set("libraries", [...r] + ""); for (k in g) e.set(k.replace(/[A-Z]/g, t => "_" + t[0].toLowerCase()), g[k]); e.set("callback", c + ".maps." + q); a.src = `https://maps.${c}apis.com/maps/api/js?` + e; d[q] = f; a.onerror = () => h = n(Error(p + " could not load.")); a.nonce = m.querySelector("script[nonce]")?.nonce || ""; m.head.append(a) })); d[l] ? console.warn(p + " only loads once. Ignoring:", g) : d[l] = (f, ...n) => r.add(f) && u().then(() => d[l](f, ...n)) })
			({ key: "AIzaSyB41DRUbKWJHPxaFjMAwdrzWzbVKartNGg", v: "weekly" });
	</script>

	<!-- Start Google Maps API for Javascript -->
	<script th:inline="javascript">
		//var map;
		var maplist = [];
		var geocoder;
		var service;
		var infowindow;
		var request;
		var originCity = [[${ currTrip.location }]];
		var origincoords = [];
		var mapindex;
		var locationcounter = [[${ itinerary }]];

		//initialize maps
		async function initMap() {

			//loads necessary libraries
			const { Map, InfoWindow } = await google.maps.importLibrary("maps");
			const { Geocoder } = await google.maps.importLibrary("geocoding");
			const { PlacesService } = await google.maps.importLibrary("places");
			const { AdvancedMarkerElement } = await google.maps.importLibrary("marker");

			// new variables to start respective processes
			geocoder = new google.maps.Geocoder();

			//first for loop is to iterate between each day of itinerary
			for (var i = 1; i < Object.keys(locationcounter).length + 1; i++) {
				//second for loop is to iterate between each location for each day
				for (var j = 0; j < Object.keys(locationcounter["Day " + i]).length; j++) {

					mapindex = (i - 1) * 4 + j;

					var mapOptions = {
						zoom: 18,
						center: { lat:0, lng:0 },
					}

					var map = new google.maps.Map(document.getElementById("map" + mapindex), mapOptions);
					maplist.push(map);

					geocoder.geocode({ 'address': originCity }, function (results, status) {
						if (status == google.maps.GeocoderStatus.OK) {

							var latitude = results[0].geometry.location.lat();
							var longitude = results[0].geometry.location.lng();
							origincoords.push(results[0].geometry.location);
						}
					});
					document.getElementById("map" + mapindex).setAttribute("style", "height:500px");


					// ADD CODE HERE TO LOOP A TARGET TO ADDEVENTLISTENER AND CALL updateCenter(index)
					
				}

			}
		}

		function updateCenter(index) {
				maplist[index].setCenter(origincoords[index]);
		}

		window.initMap = initMap();
	</script>

</body>

</html>